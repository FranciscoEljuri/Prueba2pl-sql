DECLARE
V_CODIGO_ERROR VARCHAR2(200);

--DECLARAMOS EL TYPE Y UN VARRAY PARA LA FECHA
    TYPE T_FECHAS IS VARRAY(2) OF VARCHAR2(10);
    V_FECHA T_FECHAS := T_FECHAS(TO_CHAR(SYSDATE,'MONTH'), TO_CHAR(SYSDATE,'YYYY'));
    
---DECLARAMOS EL CURSOR DE CENTRO DE DISTRIBUCION
    CURSOR CUR_CENTROS_DISTRIBUCION IS
        SELECT CODIGO,
                NOMBRE
        FROM CENTRO_DISTRIBUCION
        ;
        
--DECLARAMOS EL TYPE DE CENTRO DE DISTRIBUCION    
    TYPE T_CENTRO_DISTRIBUCION IS RECORD(
        CODIGO  CENTRO_DISTRIBUCION.CODIGO%TYPE,
        NOMBRE  CENTRO_DISTRIBUCION.NOMBRE%TYPE
    );
    
--DECLARAMOS EL CURSOR DE PRODUCTOS CON PARAMETRO
    CURSOR CUR_PRODUCTOS(PAR_CODIGO_CD VARCHAR2) IS
        SELECT  CODIGO,
                NOMBRE,
                PAR_CODIGO_CD
        FROM PRODUCTO
        WHERE CENTRO_DISTRIBUCION_CODIGO = PAR_CODIGO_CD
        ;
        
--DECLARAMOS EL TYPE DE PRODUCTOS
    TYPE T_PRODUCTO IS RECORD(
        CODIGO  PRODUCTO.CODIGO%TYPE,
        NOMBRE  PRODUCTO.NOMBRE%TYPE,
        CODIGO_CENTRO   PRODUCTO.CENTRO_DISTRIBUCION_CODIGO%TYPE
    );
    
--DECLARAMOS LAS VARIABLES

    --VARIABLES CENTRO DE DISTRIBUCION
        V_CENTRO_DISTRIBUCION   T_CENTRO_DISTRIBUCION;
        
    --VARIABLES PRODUCTO
        V_PRODUCTO  T_PRODUCTO;
    
BEGIN
--ABRIMOS Y CERRAMOS CURSOR DE CENTRO DE DISTRIBUCION

    OPEN CUR_CENTROS_DISTRIBUCION;
        LOOP
            FETCH CUR_CENTROS_DISTRIBUCION INTO V_CENTRO_DISTRIBUCION;
            EXIT WHEN CUR_CENTROS_DISTRIBUCION%NOTFOUND;
          
     -------ABRIMOS Y CERRAMOS CURSOR DE PRODUCTO  
         
            OPEN CUR_PRODUCTOS(V_CENTRO_DISTRIBUCION.CODIGO);
                LOOP
                    FETCH CUR_PRODUCTOS INTO V_PRODUCTO;
                    EXIT WHEN CUR_PRODUCTOS%NOTFOUND;
                    
                    DBMS_OUTPUT.PUT_LINE('|   - '||V_PRODUCTO.CODIGO||' | '||V_PRODUCTO.NOMBRE||' | '||V_PRODUCTO.CODIGO_CENTRO||' | '||RTRIM(V_FECHA(1))||'/'||V_FECHA(2));
                END LOOP;
            CLOSE CUR_PRODUCTOS;
      --------------------------------------------  
      
            DBMS_OUTPUT.PUT_LINE('* '||V_CENTRO_DISTRIBUCION.CODIGO||' | '||V_CENTRO_DISTRIBUCION.NOMBRE);
        END LOOP;
    CLOSE CUR_CENTROS_DISTRIBUCION;

EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('HOUTON TENEMOS UN PROBLEMA');
        V_CODIGO_ERROR := SQLERRM;
        INSERT INTO ERROR_PROCESO VALUES (
            SEQ_ERROR_PROCESO.NEXTVAL,
            V_CODIGO_ERROR,
            'HOUTON TENEMOS UN PROBLEMA'
        );
END;